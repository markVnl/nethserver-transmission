{

return '#  transmission-WebDL  is  disabled' unless  ((${'transmission'}{'status'} || 'disabled') eq 'enabled') ;

use esmith::AccountsDB;
#use esmith::DB;
use esmith::ConfigDB;


my $acc = esmith::AccountsDB->open_ro; 
my $c = esmith::ConfigDB->open;


my $transmissionDIR = $c->get_prop('transmission','DownloadDir') || '/var/lib/transmission/Downloads';
my $name = $c->get_prop('transmission','WebNameDir') || 'dl-transmission';

$OUT .= qq (
    Alias /$name    $transmissionDIR
    <Directory $transmissionDIR/>
        Options Indexes
        order deny,allow
        deny from all
        SSLRequireSSL
);

my $webaccess = $c->get_prop('transmission','Webaccess')||'private';

if ($webaccess eq 'private')
    {       
    $OUT .= "       allow from $localAccess\n";
    } 

elsif ($webaccess eq 'public')
   {
   $OUT .= "        allow from all\n";
   }

$OUT .= qq (
        AuthName "$name"
        AuthBasicProvider external
        AuthType Basic
        AuthExternal pwauth
);
$OUT .= "        require user  ";

foreach my $user ($acc->users()) {
    my $username = $user->key;
    my $transuser = $user->prop('TransmissionWebFolder')|| 'disabled';
    next unless  ($transuser eq 'enabled');
    $OUT .= " $username";
}

$OUT .= "\n    </Directory>";
}
